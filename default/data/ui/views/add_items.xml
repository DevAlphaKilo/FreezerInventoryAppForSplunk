<form stylesheet="input-forms.css" script="add-items.js,autofill-date-today.js">
  <label>Add Items</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="item_type">
      <label>Item Type</label>
      <fieldForLabel>item_types</fieldForLabel>
      <fieldForValue>item_types</fieldForValue>
      <search>
        <query>| inputlookup item_types</query>
        <earliest>-4h@m</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="dropdown" token="item_subtype" searchWhenChanged="true">
      <label>Subtype</label>
      <fieldForLabel>item_subtype</fieldForLabel>
      <fieldForValue>item_subtype</fieldForValue>
      <search>
        <query>| inputlookup item_subtypes | search item_type="$item_type$"</query>
        <earliest>-4h@m</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input type="dropdown" token="item_sub_subtype" searchWhenChanged="true">
      <label>Item Sub Subtype</label>
      <fieldForLabel>item_sub_subtype</fieldForLabel>
      <fieldForValue>item_sub_subtype</fieldForValue>
      <search>
        <query>| inputlookup item_sub_subtypes WHERE item_subtype="$item_subtype$"</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
    <input id="purchase_date" type="text" token="purchase_date" searchWhenChanged="true">
      <label>Purchase Date</label>
    </input>
    <input id="sealed_date" type="text" token="sealed_date" searchWhenChanged="true">
      <label>Sealed Date</label>
    </input>
    <input type="dropdown" token="cut_qty" searchWhenChanged="true">
      <label>Cut Quantity</label>
      <default>1</default>
      <initialValue>1</initialValue>
      <fieldForLabel>count</fieldForLabel>
      <fieldForValue>count</fieldForValue>
      <search>
        <query>| makeresults count=10
| streamstats count</query>
      </search>
    </input>
    <input type="dropdown" token="pack_qty" searchWhenChanged="true">
      <label>Pack Quantity</label>
      <default>1</default>
      <initialValue>1</initialValue>
      <fieldForLabel>count</fieldForLabel>
      <fieldForValue>count</fieldForValue>
      <search>
        <query>| makeresults count=10
| streamstats count</query>
      </search>
      <prefix>count=</prefix>
    </input>
  </fieldset>
  <row>
    <panel depends="$input_complete$">
      <title>Addition(s) Preview</title>
      <table id="new_items">
        <search>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="input_complete">true</set>
            </condition>
            <condition>
              <unset token="input_complete"></unset>
            </condition>
          </progress>
          <query>| makeresults $pack_qty$
| streamstats count AS pack_id
| eval item_type="$item_type$", item_subtype="$item_subtype$", item_sub_subtype="$item_sub_subtype$", cut_qty="$cut_qty$"
| eval purchase_date=strftime(strptime("$purchase_date$", "%m/%d/%Y"), "%m/%d/%Y %H:%M:%S")
| eval sealed_date=strftime(strptime("$sealed_date$", "%m/%d/%Y"), "%m/%d/%Y %H:%M:%S")
| eval input_date=strftime(now(), "%m/%d/%Y %H:%M:%S") 
| eval item_id=sha512(pack_id + input_date + item_type + item_subtype + item_sub_subtype + purchase_date + sealed_date + cut_qty)
| table pack_id, item_id, input_date, item_type, item_subtype, item_sub_subtype, purchase_date, sealed_date, cut_qty</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <input id="submit_button" type="button" value="Submit Input"/>
        <br/>
        <br/>
        <br/>
      </html>
    </panel>
  </row>
  <row>
    <panel depends="$show_recent$">
      <table>
        <title>Item(s) Recently Added</title>
        <search>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="show_recent">true</set>
            </condition>
            <condition>
              <unset token="show_recent"></unset>
            </condition>
          </progress>
          <query>`freezer_items`
| stats values(item_id) count by _time, item_type, item_subtype, item_sub_subtype
| sort - _time
| rename _time AS "Time"
| eval Time=strftime(Time, "%m/%d/%y %H:%M:%S")</query>
          <earliest>@d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>
</form>